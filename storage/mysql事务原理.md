# 概述
作为一名处于一线开发的工程师，MySQL是我最常用的存储，理解MySQL事务的实现原理是相当有必要的。
那么，问题就来了：
- 数据库事务是什么？
- 数据库事务的原理是什么？
- 以哪个切入点去学习？

__个人认为，理解数据库事务的原理，本质上就是理解数据库事务特性的实现过程。__

所以，我们从数据库事务特性开始。

# 事务原理
数据库事务是数据库管理系统执行过程中的一个逻辑单位，由一个有限的数据库操作序列构成。
事务有四个特性，分别是原子性(Atomicity)、一致性(Consistency)、 隔离性(Isolation)、持久性(Durability)，即ACID。

## 原子性
### 概念
事务是一个不可分割的整体，事务开始后要么全部做完要么全部不做，不可能停滞在中间环节。如执行出错则回滚到事务开始前的状态，所有的操作就像没有发生一样。

```
# A给B转账100元
SELECT * FROM tb WHERE user='A'; 
UPDATE tb SET amount=amout-100 WHERE user='A';
SELECT * FROM tb WHERE user='B';
UPDATE tb SET amount=amout+100 WHERE user='B';
```
> 其侧重点是事务执行的完整，确保每一步的执行都是成功的，如果有一步失败，那整体失败。如以上例子，必须是A扣钱B加钱同时成功或者失败。
### 实现
依赖`undo log`。
要保证事务的原子性，就需要在异常发生时，对已经执行的操作进行回滚，而在 MySQL 中，恢复机制是通过回滚日志（undo log）实现的，所有事务进行的修改都会先记录到这个回滚日志中，然后在对数据库中的对应行进行写入。

## 一致性
### 概念
事务执行之前和执行之后，数据库的状态一定是一致的。
```
# A给B转账100元
UPDATE tb SET amount=amout-100 WHERE user='A';
UPDATE tb SET amount=amout+100 WHERE user='B';
```
> 其侧重点是事务按照预期生效，可以认为事务的其他特性都是为了实现一致性。如以上例子，A扣钱成功B没加钱，那就是不一致的状态。

## 隔离性
多个事务并发访问时，事务之间是隔离的，一个事务不应该影响其它事务运行效果。

隔离级别
- Serializable (串行化)：可避免脏读、不可重复读、幻读的发生。
- Repeatable read (可重复读)：可避免脏读、不可重复读的发生。
- Read committed (读已提交)：可避免脏读的发生。
- Read uncommitted (读未提交)：最低级别，任何情况都无法保证。

## 持久性
事务提交成功后，所有的修改保存在数据库中不可改变或丢失，即使是系统或介质发生故障也不可改变或丢失。


# 参看文献
1. [百度百科-数据库事务](https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1)
