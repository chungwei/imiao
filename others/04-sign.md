# 数字签名算法

## 背景
为了保证数据传输过程中的数据真实性和完整性，我们需要对数据进行数字签名，在接收签名数据之后进行签名校验。  

## 算法
### 步骤:  
1. 按一定规则拼接要签名的原始串
2. 选择具体的算法和密钥计算出签名结果 

### 拼接签名原始串
无论是请求还是应答，无论是用 get、post 还是xml，签名原始串按以下方式组装成字符串：  
1. 除 sign 字段外，所有参数按照字段名的 ascii 码从小到大排序后使用 QueryString 的格式（即key1=value1&key2=value2）拼接而成，空值不传递，不参与签名组串
2. 所有参数是指通信过程中实际出现的所有非空参数，即使是接口中无描述的字段，也需要参与签名组串。
例如接口中无test字段，但上游请求时包含test字段且有值，那么该字段也得参与签名组串 
3. 签名原始串中，字段名和字段值都采用原始值，不进行 URL Encode

### 签名计算
目前暂只支持 MD5签名。  

MD5 是一种摘要生成算法，通过在签名原始串后加上商户通信密钥的内容，进行 MD5运算，形成的摘要字
符串即为签名结果。为了方便比较，签名结果统一转换为大写字符。 

MD5 签名计算公式：  
sign = Md5(原字符串&key=商户密钥)->toUpperCase 


## 举例
调用某个接口，接口有如下字段：  
partner、desc、attach  

实际调用接口时，各字段的值：  
partner=1900000109，desc=a&b，attach=，test=1 

正确的签名原始串是：  
desc=a&b&partner=1900000109&test=1  

常见的错误有：  
desc=a%26b&partner=1900000109&test=1    
desc=a&b&partner=1900000109  
attach=&desc=a&b&partner=1900000109&test=1  
partner=1900000109&desc=a&b&test=1  

密钥是：  
8db4a013a8   

签名的结果为：   
md5(desc=a&b&partner=1900000109&test=1&key=8db4a013a8
)->toUpperCase = 8DB4A013A8B515349C307F1E448CE836 

